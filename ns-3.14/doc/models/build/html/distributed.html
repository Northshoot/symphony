

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>MPI for Distributed Simulation &mdash; Model Library</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     'ns-3-dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Model Library" href="index.html" />
    <link rel="next" title="Mobility" href="mobility.html" />
    <link rel="prev" title="Mesh NetDevice" href="mesh.html" />
  <link rel="stylesheet" type="text/css"
    href="_static/ns3_stylesheet.css" />
    <link rel="icon" type="image/ico" 
      href="_static/favicon.ico" />

  <script type="text/javascript" src="_static/drop-down-menu.js"></script>
  <script type="text/javascript" src="_static/ns3_version.js"></script>
  <script type="text/javascript">var ns3_builder="html";</script>
  <script type="text/javascript" src="_static/ns3_links.js"></script>
      

  </head>
  <body>
  <div id="titlearea">
    <table cellspacing="0" cellpadding="0" width="100%">
      <tbody>
	<tr style="height: 56px;">
	  <td id="projectlogo">
	    <a id="ns3_home1"
	       href="http://www.nsnam.org/">
	       <img alt="ns-3 Logo"
		    src="_static/ns-3-inverted-notext-small.png"/>
	    </a>
	  </td>
	  <td id="projecttext">
	    <div id="projectbrief">A Discrete-Event Network Simulator</div>
	      <span id="projectnumber"><script type="text/javascript">document.write(ns3_version)</script></span>
	  </td>
	      
	  <td id="ns3-menu">
	    <div class="menu">
	      <ul >
	        <li><a id="ns3_home2"
		       href="http://www.nsnam.org/"
		       >&nbsp;&nbsp;Home</a>
	        </li>
	        <li><span
		      onmouseover="mopen('mTuts')" 
		      onmouseout="mclosetime()"
			>Tutorials &nbsp;&#x25BC;</span>
		    <div id="mTuts" 
		        onmouseover="mcancelclosetime()" 
		        onmouseout="mclosetime()">
		      <a id="ns3_tut"
			 href="/docs/tutorial/html/index.html"
			  >English</a><br/>
		      <a id="ns3_ptbr"
			 href="/docs/tutorial-pt-br/html/index.html"
			    >Portuguese</a><br/>
	        </li>
	        <li><span
		      onmouseover="mopen('mDocs')" 
		      onmouseout="mclosetime()"
			>Docs &nbsp;&nbsp;&nbsp;&#x25BC;</span>
		    <div id="mDocs"
		        onmouseover="mcancelclosetime()" 
		        onmouseout="mclosetime()">
		      <a id="ns3_wiki"
			 href="http://www.nsnam.org/wiki"
			 >Wiki</a><br/>
		      <a id="ns3_man"
			 href="/docs/manual/html/index.html"
			 >Manual</a><br/>
		      <a id="ns3_mod"
			 href="/docs/models/html/index.html"
			 >Models</a><br/>
	        </li>
	        <li><span
		      onmouseover="mopen('mDev')" 
		      onmouseout="mclosetime()"
			>Develop &#x25BC;</span>
		    <div id="mDev"
		        onmouseover="mcancelclosetime()" 
		        onmouseout="mclosetime()">
		      <a id="ns3_api"
			 href="/docs/doxygen/html/index.html"
			 >API</a><br/>
		      <a id="ns3_bugs"
		       href="http://www.nsnam.org/bugzilla/">Bugs</a>
	        </li>
	      </ul>
	    </div>
	  </td>
	  <td id="projectsection">
	    <span style="margin-right:10px">Models</span>
	  </td>
	</tr>
      </tbody>
    </table>
    <script  type="text/javascript">ns3_write_links()</script>
  </div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="mobility.html" title="Mobility"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="mesh.html" title="Mesh NetDevice"
             accesskey="P">previous</a> |</li>
    <li class="navelem"><a href="">ns-3</a><span class="navelem">&nbsp;</span></li>
    
        <li><a href="index.html">Models</a><span class="navelem">&nbsp;</span></li>
 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="mpi-for-distributed-simulation">
<h1>MPI for Distributed Simulation<a class="headerlink" href="#mpi-for-distributed-simulation" title="Permalink to this headline">¶</a></h1>
<p>Parallel and distributed discrete event simulation allows the execution of a
single simulation program on multiple processors. By splitting up the simulation
into logical processes, LPs, each LP can be executed by a different processor.
This simulation methodology enables very large-scale simulations by leveraging
increased processing power and memory availability. In order to ensure proper
execution of a distributed simulation, message passing between LPs is required.
To support distributed simulation in <em>ns-3</em>, the standard Message Passing
Interface (MPI) is used, along with a new distributed simulator class.
Currently, dividing a simulation for distributed purposes in <em>ns-3</em> can only occur
across point-to-point links.</p>
<div class="section" id="current-implementation-details">
<span id="id1"></span><h2>Current Implementation Details<a class="headerlink" href="#current-implementation-details" title="Permalink to this headline">¶</a></h2>
<p>During the course of a distributed simulation, many packets must cross simulator
boundaries. In other words, a packet that originated on one LP is destined for a
different LP, and in order to make this transition, a message containing the
packet contents must be sent to the remote LP. Upon receiving this message, the
remote LP can rebuild the packet and proceed as normal. The process of sending
an receiving messages between LPs is handled easily by the new MPI interface in
<em>ns-3</em>.</p>
<p>Along with simple message passing between LPs, a distributed simulator is used
on each LP to determine which events to process. It is important to process
events in time-stamped order to ensure proper simulation execution. If a LP
receives a message containing an event from the past, clearly this is an issue,
since this event could change other events which have already been executed. To
address this problem, a conservative synchronization algorithm with lookahead is
used in <em>ns-3</em>. For more information on different synchronization approaches and
parallel and distributed simulation in general, please refer to &#8220;Parallel and
Distributed Simulation Systems&#8221; by Richard Fujimoto.</p>
<div class="section" id="remote-point-to-point-links">
<h3>Remote point-to-point links<a class="headerlink" href="#remote-point-to-point-links" title="Permalink to this headline">¶</a></h3>
<p>As described in the introduction, dividing a simulation for distributed purposes
in <em>ns-3</em> currently can only occur across point-to-point links; therefore, the
idea of remote point-to-point links is very important for distributed simulation
in <em>ns-3</em>. When a point-to-point link is installed, connecting two nodes, the
point-to-point helper checks the system id, or rank, of both nodes. The rank
should be assigned during node creation for distributed simulation and is
intended to signify on which LP a node belongs. If the two nodes are on the same
rank, a regular point-to-point link is created. If, however, the two nodes are
on different ranks, then these nodes are intended for different LPs, and a
remote point-to-point link is used. If a packet is to be sent across a remote
point-to-point link, MPI is used to send the message to the remote LP.</p>
</div>
<div class="section" id="distributing-the-topology">
<h3>Distributing the topology<a class="headerlink" href="#distributing-the-topology" title="Permalink to this headline">¶</a></h3>
<p>Currently, the full topology is created on each rank, regardless of the
individual node system ids. Only the applications are specific to a rank. For
example, consider node 1 on LP 1 and node 2 on LP 2, with a traffic generator on
node 1. Both node 1 and node 2 will be created on both LP1 and LP2; however, the
traffic generator will only be installed on LP1. While this is not optimal for
memory efficiency, it does simplify routing, since all current routing
implementations in <em>ns-3</em> will work with distributed simulation.</p>
</div>
</div>
<div class="section" id="running-distributed-simulations">
<h2>Running Distributed Simulations<a class="headerlink" href="#running-distributed-simulations" title="Permalink to this headline">¶</a></h2>
<div class="section" id="prerequisites">
<h3>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h3>
<p>Ensure that MPI is installed, as well as mpic++. In Ubuntu repositories,
these are openmpi-bin, openmpi-common, openmpi-doc, libopenmpi-dev. In
Fedora, these are openmpi and openmpi-devel.</p>
<p>Note:</p>
<p>There is a conflict on some Fedora systems between libotf and openmpi. A
possible &#8220;quick-fix&#8221; is to yum remove libotf before installing openmpi.
This will remove conflict, but it will also remove emacs. Alternatively,
these steps could be followed to resolve the conflict::</p>
<div class="highlight-python"><pre>1) Rename the tiny otfdump which emacs says it needs:

     mv /usr/bin/otfdump /usr/bin/otfdump.emacs-version

2) Manually resolve openmpi dependencies:

     sudo yum install libgfortran libtorque numactl

3) Download rpm packages:

     openmpi-1.3.1-1.fc11.i586.rpm
     openmpi-devel-1.3.1-1.fc11.i586.rpm
     openmpi-libs-1.3.1-1.fc11.i586.rpm
     openmpi-vt-1.3.1-1.fc11.i586.rpm

     from

     http://mirrors.kernel.org/fedora/releases/11/Everything/i386/os/Packages/

4) Force the packages in:

     sudo rpm -ivh --force openmpi-1.3.1-1.fc11.i586.rpm
     openmpi-libs-1.3.1-1.fc11.i586.rpm openmpi-devel-1.3.1-1.fc11.i586.rpm
     openmpi-vt-1.3.1-1.fc11.i586.rpm</pre>
</div>
<p>Also, it may be necessary to add the openmpi bin directory to PATH in order to
execute mpic++ and mpirun from the command line. Alternatively, the full path to
these executables can be used. Finally, if openmpi complains about the inability
to open shared libraries, such as libmpi_cxx.so.0, it may be necessary to add
the openmpi lib directory to LD_LIBRARY_PATH.</p>
<p>Here is an example of setting up PATH and LD_LIBRARY_PATH using a bash shell::</p>
<div class="highlight-python"><pre>For a 32-bit Linux distribution:

     export PATH=$PATH:/usr/lib/openmpi/bin
     export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/lib/openmpi/lib

For a 64-bit Linux distribution:

     export PATH=$PATH:/usr/lib64/openmpi/bin
     export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/lib64/openmpi/lib</pre>
</div>
<p>These lines can be added into ~/.bash_profile or ~/.bashrc to avoid having to
retype them when a new shell is opened.</p>
</div>
<div class="section" id="building-and-running-examples">
<h3>Building and Running Examples<a class="headerlink" href="#building-and-running-examples" title="Permalink to this headline">¶</a></h3>
<p>If you already built <em>ns-3</em> without MPI enabled, you must re-build::</p>
<div class="highlight-python"><pre>./waf distclean</pre>
</div>
<p>Configure <em>ns-3</em> with the &#8211;enable-mpi option::</p>
<div class="highlight-python"><pre>./waf -d debug configure --enable-examples --enable-tests --enable-mpi</pre>
</div>
<p>Ensure that MPI is enabled by checking the optional features shown from the
output of configure.</p>
<p>Next, build <em>ns-3</em>::</p>
<div class="highlight-python"><pre>./waf</pre>
</div>
<p>After building <em>ns-3</em> with mpi enabled, the example programs are now ready to run
with mpirun. Here are a few examples (from the root <em>ns-3</em> directory)::</p>
<div class="highlight-python"><pre>mpirun -np 2 ./waf --run simple-distributed
mpirun -np 4 -machinefile mpihosts ./waf --run 'nms-udp-nix --LAN=2 --CN=4 --nix=1'</pre>
</div>
<p>The np switch is the number of logical processors to use. The machinefile switch
is which machines to use. In order to use machinefile, the target file must
exist (in this case mpihosts). This can simply contain something like::</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">localhost</span>
<span class="n">localhost</span>
<span class="n">localhost</span>
<span class="o">...</span>
</pre></div>
</div>
<p>Or if you have a cluster of machines, you can name them.</p>
<p>NOTE: Some users have experienced issues using mpirun and waf together. An
alternative way to run distributed examples is shown below::</p>
<div class="highlight-python"><pre>./waf shell
cd build/debug
mpirun -np 2 src/mpi/examples/simple-distributed</pre>
</div>
</div>
<div class="section" id="creating-custom-topologies">
<h3>Creating custom topologies<a class="headerlink" href="#creating-custom-topologies" title="Permalink to this headline">¶</a></h3>
<p>The example programs in src/mpi/examples give a good idea of how to create different
topologies for distributed simulation. The main points are assigning system ids
to individual nodes, creating point-to-point links where the simulation should
be divided, and installing applications only on the LP associated with the
target node.</p>
<p>Assigning system ids to nodes is simple and can be handled two different ways.
First, a NodeContainer can be used to create the nodes and assign system ids::</p>
<div class="highlight-python"><pre>NodeContainer nodes;
nodes.Create (5, 1); // Creates 5 nodes with system id 1.</pre>
</div>
<p>Alternatively, nodes can be created individually, assigned system ids, and added
to a NodeContainer. This is useful if a NodeContainer holds nodes with different
system ids::</p>
<div class="highlight-python"><pre>NodeContainer nodes;
Ptr&lt;Node&gt; node1 = CreateObject&lt;Node&gt; (0); // Create node1 with system id 0
Ptr&lt;Node&gt; node2 = CreateObject&lt;Node&gt; (1); // Create node2 with system id 1
nodes.Add (node1);
nodes.Add (node2);</pre>
</div>
<p>Next, where the simulation is divided is determined by the placement of
point-to-point links. If a point-to-point link is created between two
nodes with different system ids, a remote point-to-point link is created,
as described in <a class="reference internal" href="#current-implementation-details"><em>Current Implementation Details</em></a>.</p>
<p>Finally, installing applications only on the LP associated with the target node
is very important. For example, if a traffic generator is to be placed on node
0, which is on LP0, only LP0 should install this application.  This is easily
accomplished by first checking the simulator system id, and ensuring that it
matches the system id of the target node before installing the application.</p>
</div>
</div>
<div class="section" id="tracing-during-distributed-simulations">
<h2>Tracing During Distributed Simulations<a class="headerlink" href="#tracing-during-distributed-simulations" title="Permalink to this headline">¶</a></h2>
<p>Depending on the system id (rank) of the simulator, the information traced will
be different, since traffic originating on one simulator is not seen by another
simulator until it reaches nodes specific to that simulator. The easiest way to
keep track of different traces is to just name the trace files or pcaps
differently, based on the system id of the simulator. For example, something
like this should work well, assuming all of these local variables were
previously defined::</p>
<div class="highlight-python"><pre>if (MpiInterface::GetSystemId () == 0)
  {
    pointToPoint.EnablePcapAll ("distributed-rank0");
    phy.EnablePcap ("distributed-rank0", apDevices.Get (0));
    csma.EnablePcap ("distributed-rank0", csmaDevices.Get (0), true);
  }
else if (MpiInterface::GetSystemId () == 1)
  {
    pointToPoint.EnablePcapAll ("distributed-rank1");
    phy.EnablePcap ("distributed-rank1", apDevices.Get (0));
    csma.EnablePcap ("distributed-rank1", csmaDevices.Get (0), true);
  }</pre>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">MPI for Distributed Simulation</a><ul>
<li><a class="reference internal" href="#current-implementation-details">Current Implementation Details</a><ul>
<li><a class="reference internal" href="#remote-point-to-point-links">Remote point-to-point links</a></li>
<li><a class="reference internal" href="#distributing-the-topology">Distributing the topology</a></li>
</ul>
</li>
<li><a class="reference internal" href="#running-distributed-simulations">Running Distributed Simulations</a><ul>
<li><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li><a class="reference internal" href="#building-and-running-examples">Building and Running Examples</a></li>
<li><a class="reference internal" href="#creating-custom-topologies">Creating custom topologies</a></li>
</ul>
</li>
<li><a class="reference internal" href="#tracing-during-distributed-simulations">Tracing During Distributed Simulations</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="mesh.html"
                        title="previous chapter">Mesh NetDevice</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="mobility.html"
                        title="next chapter">Mobility</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/distributed.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="mobility.html" title="Mobility"
             >next</a> |</li>
        <li class="right" >
          <a href="mesh.html" title="Mesh NetDevice"
             >previous</a> |</li>
    <li class="navelem"><a href="">ns-3</a><span class="navelem">&nbsp;</span></li>
    
        <li><a href="index.html">Models</a><span class="navelem">&nbsp;</span></li>
 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011, ns-3 project.
      Last updated on Oct 17, 2012 10:56.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>